<!DOCTYPE html>
<html>

<!--Banner: Elise Note: I have 0 idea why this works up here, but Mahnaz made it work, so :D -->
      <div class="hero-image" href="picture">
      <div class="hero-text">
         <h1>Hello!</h1>
       </div>
     </div>
<head>

 <!-- Site Design-->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"> </script>
   <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
   <link rel="stylesheet" href = "..\style\MainStyle.css">

   <!-- D3, jQuery, Sheetrock-->

   <script src="https://d3js.org/d3.v5.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sheetrock/1.1.4/dist/sheetrock.min.js"></script>

   <title> Assignment 3 | GEOM 4001 </title>

 <!--Topbar-->
 <div class="topnav">
   <a href="..\index.html">Home</a>
   <a href="..\Assignment1\index.html">Assignment 1</a>
   <a href="..\Assignment2\index.html">Assignment 2</a>
   <a class="active" href="index.html">Assignment 3</a>
 </div>
</head>

<body>
  <p style="margin: 10%;margin-top: 60px; margin-bottom: 5px; text-align: center; font-size: 20pt;">
    <b> Endangered Indigenous Languages</b>
  </p>
 <br>    
 <br>  
  <svg id="canvas"> </svg>

  <script>
    var mySpreadsheet = 'https://docs.google.com/spreadsheets/d/1mUYwl5ZUTp2OHDr0hsco89YY5J8Qx2GWzTLFETzVnB4/edit#gid=1';
    var dataset = [
      {
        name: "Vulnerable",
        children: [] //     for when    "degree":"Vulnerable",

      },
      {
        name: "Definitely endangered",
        children: [] //     for when    "degree":"Definitely endangered",

      },
      {
        name: "Severely endangered",
        children: [] //     for when    "degree":"Severely endangered",
      },
      {
        name: "Critically endangered",
        children: [] //     for when    "degree":"Critically endangered",
      },
      {
        name: "Extinct",
        children: [] //     for when    "degree":"Extinct",
      }
    ]; //, groups = [];
    
    function CallBack(error, options, response){
      var datalol = response.rows;
      for (let i = 1; i < datalol.length; i++) {
       var template = {
        name:"",
        value:"",
        degree:""
      };
      template.name = response.rows[i].cellsArray[0];
      template.value = response.rows[i].cellsArray[1];
      template.degree = response.rows[i].cellsArray[2];

      if (template.degree === "Vulnerable") {
        dataset[0].children.push(template);
      } else if (template.degree === "Definitely endangered") {
        dataset[1].children.push(template);
      } else if (template.degree === "Severely endangered") {
        dataset[2].children.push(template);
      } else if (template.degree === "Critically endangered") {
        dataset[3].children.push(template);
      } else if (template.degree === "Extinct") {
        dataset[4].children.push(template);
      };
      var template = { // dont ask me why i need to reset it every time, I've got 0 idea :<)
        name:"",
        value:"",
        degree:""
      };
    }
  };
  sheetrock({
        url: mySpreadsheet,
        callback: CallBack
      });

//test array

let lang = {
'value': 7506502,
"Languages": [
    {
      "Name in English": "South Italian",
      'value': 7500000,
      "Degree of endangerment": "Vulnerable"
    },
    {
      "Name in English": "Cashinahua (Brazil)",
      'value': 6000,
      "Degree of endangerment": "Vulnerable"
    },
    {
      "Name in English": "Critically Endangered",
      'value': 421,
      "Languages": [
            {
              "Name in English": "Kiowa Apache",
              'value': 3,
              "Degree of endangerment": "Critically endangered"
            },
            {
              "Name in English": "Konkow",
              'value': 3,
              "Degree of endangerment": "Critically endangered"
            },
            {
              "Name in English": "Lake Miwok",
              'value': 3,
              "Degree of endangerment": "Critically endangered"
            },
            {
              "Name in English": "Mabiri",
              'value': 3,
              "Degree of endangerment": "Critically endangered"
            },
            {
              "Name in English": "Mescalero-Chiricahua Apache (Oklahoma)",
              'value': 3,
              "Degree of endangerment": "Critically endangered"
            }
      ]
  },
  {
    "Name in English": "Extinct",
    'value': 81,
    "Name in English": "Endangered Languages",
    "Number of speakers": 13000000,
    "Languages": [
          {
            "Name in English": "|'Auni",
            'value': 0,
            "Degree of endangerment": "Extinct"
          },
          {
            "Name in English": "|Xam",
            'value': 0,
            "Degree of endangerment": "Extinct"
          },
          {
            "Name in English": "ǁKu ǁ'e",
            'value': 0,
            "Degree of endangerment": "Extinct"
          },
          {
            "Name in English": "ǁKx'au",
            'value': 0,
            "Degree of endangerment": "Extinct"
          },
          {
            "Name in English": "ǁXegwi",
            'value': 0,
            "Degree of endangerment": "Extinct"
          }
        ]
      }
    ]
  };

// D3 CHART BEGINS HERE

let canvas = d3.select('#canvas')

let drawTreeMap = () => {
  let hierarchy = d3.hierarchy(lang,
   (node) => {
    return node['Languages']
   }
  ).sum(
   (node) => {
    return node['value']
   }
  ).sort((node1,node2) => {
    return node2['value'] - node1['value']
  })
  
  let createTreeMap = d3.treemap()
                        .size([1000,600])

  createTreeMap(hierarchy)

  let langTiles = hierarchy.leaves()
  
  console.log(langTiles)

 console.log(hierarchy.leaves())
  let block = canvas.selectAll('g')
                    .data(langTiles)
                    .enter()
                    .append('g')

  block.append('rect')
       .attr('class', 'tile')
       .attr('transform', (language) => {
	                     return 'translate (' + language['x0'] + ', ' + language['y0'] +')'
                    })
                    .attr('width', (language) => {
                      return language['x1'] - language['x0']
                    })
                    .attr('height', (language) => {
                      return language['y1'] - language['y0']
                    })
       .attr('fill', '#ff0000')/*(language) => {
        let degree = language['data']['Degree of endangerment']
        if(degree === 'Vulnerable'){
          return '#ffff00'
        }else if(degree === 'Definitely endangered'){
          return '#fff500'
        }else if(degree === 'Critically endangered'){
          return 'ff5000'
        }else if(degree === 'Extinct'){
          return '#ff0000'
       } else{
        return '#808080' */

/*

let canvas = d3.select('#canvas') //canvas id

let assignmentData  = dataset; // to keep the original

console.log("reference array: "); // reference

console.log(assignmentData); // reference


let drawTreeMap = () => {
  let hierarchy = d3.hierarchy(assignmentData,
   (node) => {
    return node['children']
   }
  ).sum(
   (node) => {
    return node['value']
   }
  ).sort(
   (node1,node2) => {
    return node2['value'] - node1['value']
   }
  )

 let createTreeMap = d3.treemap()
                       .size([1000,600])

 createTreeMap(hierarchy)

 langTiles = hierarchy.leaves()


 let block = canvas.selectAll('g')
                .data(langTiles)
                .enter()
                .append('g')

 block.append('rect')
      .attr('class', 'tile')
      /*.attr('fill', (dataset) => {
    let category = data['Languages']['degree']
    if(category === 'Vulnerable'){
        return '#ffff00'
    }else if(category === 'Definitely endangered'){
        return 'ffa500'
    }else if(category === 'Severely endangered'){
        return '#ff4500'
    }else if(category === 'Family'){
        return '#ff0000'
    }else if(category === 'Extinct'){
        return '#808080'
    }
})*/
}; 
  </script>
<footer class="bg-dark p-4">
 <div class="container">
   Designed and developed by Elise and Mahnaz <br> GEOM 4001 <br>  Contact us: <a href="mailto:geom4001group@gmail.com"> geom4001group@gmail.com</a> <br> Github : <a href="https://github.com/geom4001-group">geom4001-group</a>
   </div>
  </footer>
</body>
</html>